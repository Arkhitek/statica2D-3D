# Statica 2D - 操作ガイド

## 概要
Statica 2Dは、2次元フレーム構造の解析と断面算定を行うWebアプリケーションです。AIによるモデル生成、音声入力、3Dビューア、スプレッドシート入力などの先進的な機能を搭載しています。

## 目次
1. [基本操作](#基本操作)
2. [スプレッドシート入力](#スプレッドシート入力)
3. [AIによるモデル生成](#aiによるモデル生成)
4. [音声入力機能](#音声入力機能)
5. [断面選択と算定](#断面選択と算定)
6. [3Dビューア](#3dビューア)
7. [計算実行と結果表示](#計算実行と結果表示)
8. [データ保存・読込](#データ保存読込)
9. [プリセット機能](#プリセット機能)
10. [トラブルシューティング](#トラブルシューティング)

---

## 基本操作

### キャンバス操作
- **選択/移動モード (S)**: 節点や部材を選択・移動
- **節点追加モード (N)**: キャンバスをクリックして節点を追加
- **部材追加モード (M)**: 2つの節点をクリックして部材を追加
- **フレームジェネレーター**: 多層多スパンラーメン構造を自動生成

### ショートカットキー
- `S`: 選択/移動モード
- `N`: 節点追加モード
- `M`: 部材追加モード
- `G`: グリッド表示切替
- `Ctrl+Z`: 元に戻す
- `Ctrl+S`: 入力データ保存
- `Ctrl+O`: 入力データ読込

### 表示設定
- **グリッド表示**: 座標グリッドの表示/非表示
- **部材情報**: マウスオーバー時の部材情報表示
- **ズーム**: `+`/`-`ボタンで拡大・縮小

---

## スプレッドシート入力

### 概要
Excelのような表形式でモデルデータを一括編集できる機能です。大量のデータを効率的に入力・編集する場合に便利です。

### 起動方法
1. 画面上部のツールバーにある「スプレッドシート入力」ボタンをクリックします。
2. 新しいウィンドウでスプレッドシートが開きます。

### 機能
- **タブ切り替え**: 節点、部材、節点荷重、部材荷重の各シートを切り替えて編集できます。
- **データ反映**: 「解析モデルに反映して実行」ボタンを押すと、入力したデータがメイン画面に反映され、自動的に解析が実行されます。
- **行操作**: 行の追加・削除が可能です。

### 入力項目詳細

#### 節点シート
- **X, Y**: 座標値 (m)
- **境界条件**: ドロップダウンから選択 (Free, Pin, Fixed, RollerX, RollerY)
- **強制変位**: dx, dy, rot (任意)

#### 部材シート
- **始点No, 終点No**: 節点番号
- **材料・断面特性**: E, F, I, A, Z, i, K, 密度
  - **F値 (基準強度)**: 
    - 標準値 (235, 295, 325, 355) を入力すると、プリセットとして扱われます。
    - それ以外の数値を入力すると、「任意入力」モードとして反映されます。
- **接合条件**: 始端・終端それぞれの接合タイプを選択 (Rigid, Pin, Spring)
  - **Rigid**: 剛接合
  - **Pin**: ピン接合
  - **Spring**: バネ接合
- **バネ定数**: 接合条件で「Spring」を選択した場合、以下の列に値を入力します。
  - **Kx, Ky**: 並進バネ定数 (kN/mm)
  - **Kr**: 回転バネ定数 (kN·m/rad)
  - ※ 始端用 (spring_i_*) と終端用 (spring_j_*) の列があります。

#### 荷重シート
- **節点荷重**: 節点No, Px, Py, Mz
- **部材荷重**: 部材No, w (等分布荷重)

---

## AIによるモデル生成

### 機能の有効化
1. 「🤖 AIによるモデル生成機能を表示」チェックボックスをオンにする
2. AI生成セクションが表示されます

### 生成モード
- **新規作成**: 既存のモデルをクリアして新しいモデルを作成
- **追加編集**: 既存のモデルに部材を追加・変更

### 使用方法
1. **自然言語入力**: テキストエリアに構造の説明を入力
   ```
   例: "高さ5m、スパン10mの門型ラーメン。柱脚は固定。"
   ```

2. **音声入力**: 🎤ボタンをクリックして音声で入力

3. **AIで生成**: 「AIで生成」ボタンをクリック

### サポートされる指示例
- **基本構造**:
  - "高さ3m、スパン6mの門型ラーメン"
  - "2層2スパンのラーメン構造"
  - "片持梁、長さ4m、先端に集中荷重10kN"

- **断面指定**:
  - "柱部材をH-200×100に変更"
  - "梁の断面をH-300×150に変更"
  - "すべての部材をH-250×125に変更"

- **荷重条件**:
  - "等分布荷重5kN/m"
  - "集中荷重10kNを中央に"
  - "風荷重を考慮"

### AI生成の特徴
- **選択的更新**: 柱部材と梁部材を個別に指定可能
- **断面情報保持**: 変更されなかった部材の断面情報を保持
- **3Dビューア連携**: 生成されたモデルが自動的に3Dビューアに反映

---

## 音声入力機能

### 使用方法
1. 🎤ボタンをクリック
2. マイクへのアクセス許可を許可
3. 構造の説明を音声で入力
4. 音声認識が完了すると自動的にテキストエリアに反映

### 対応ブラウザ
- Chrome (推奨)
- Edge
- Safari (制限あり)

### 音声入力のコツ
- はっきりと話す
- 背景雑音を避ける
- 短い文で区切って話す

---

## 断面選択と算定

### 断面選択方法
1. **部材テーブル**で「断面選択...」ボタンをクリック
2. **断面選択ウィンドウ**が開きます
3. 鋼材タイプを選択（H形鋼、I形鋼、角形鋼管など）
4. 寸法を指定
5. 軸方向を選択（強軸/弱軸）
6. 「適用」をクリック

### 断面情報の表示
- **断面名称**: 板厚情報まで含む完全な名称（例：「H形鋼（細幅） 250×125×6×9」）
- **軸情報**: 強軸/弱軸の方向表示
- **断面諸量**: 断面積、断面二次モーメント、断面係数など

### 断面算定機能
- **応力度算定**: 軸力と曲げモーメントによる応力度計算
- **座屈解析**: 圧縮部材の座屈安全性検討
- **断面検定**: 許容応力度との比較

---

## 3Dビューア

### 起動方法
1. 「3Dビューアを開く」ボタンをクリック
2. 新しいウィンドウで3Dビューアが開きます

### 操作方法
- **左ドラッグ**: 回転
- **右ドラッグ**: 平行移動
- **ホイール**: ズーム

### 表示内容
- **構造モデル**: 3Dで表示されたフレーム構造
- **断面情報**: 各部材の断面形状と名称
- **軸方向**: 強軸・弱軸の方向表示
- **荷重**: 節点荷重と部材荷重の表示

### ラベル表示制御
- **節点ラベル**: 節点番号の表示/非表示
- **部材ラベル**: 部材番号の表示/非表示
- **断面名称**: 断面名称の表示/非表示

---

## 計算実行と結果表示

### 計算実行
1. 「計算実行 & アニメーション表示」ボタンをクリック
2. 構造解析が実行されます
3. 結果がアニメーションで表示されます

### 結果表示
- **変位図**: 構造の変形状況
- **応力図**: 各部材の応力分布（曲げモーメント、せん断力、軸力）
- **反力**: 支点反力の表示
- **断面検定**: 各部材の安全性検討

### 表示スタイル
- **節点番号**: 白背景の丸囲い数字で表示され、視認性が向上しています。
- **部材番号**: 四角囲みで表示されます。

### 結果の確認
- **部材情報**: マウスオーバーで詳細情報を表示
- **数値結果**: テーブル形式で数値を確認
- **グラフ表示**: 応力・変位の分布図

---

## データ保存・読込

### 保存機能
- **入力保存**: 現在の入力データをJSONファイルで保存
- **共有リンク作成**: モデルをURLで共有可能

### 読込機能
- **入力読込**: 保存したJSONファイルを読込
- **共有リンク読込**: 共有URLからモデルを読込

### ファイル形式
- **JSON形式**: 構造データ、荷重条件、断面情報を含む
- **Excel出力**: 計算結果をExcelファイルで出力

---

## プリセット機能

### 計算例プリセット
- **単純梁**: 基本的な単純梁の例
- **片持梁**: 片持梁の例
- **門型ラーメン**: 門型ラーメンの例
- **多層ラーメン**: 多層ラーメンの例

### プリセットの使用方法
1. 「計算例プリセット」ドロップダウンから選択
2. 自動的にモデルが読み込まれます
3. 断面情報も自動的に設定されます

---

## トラブルシューティング

### よくある問題

#### AI生成が動作しない
- **原因**: APIキーが設定されていない
- **解決策**: 環境変数`GEMINI_API_KEY`を設定

#### 音声入力が動作しない
- **原因**: マイクへのアクセス許可がない
- **解決策**: ブラウザの設定でマイクアクセスを許可

#### 3Dビューアが表示されない
- **原因**: Three.jsライブラリの読み込みエラー
- **解決策**: インターネット接続を確認

#### 断面情報が表示されない
- **原因**: 断面選択が完了していない
- **解決策**: 部材テーブルで「断面選択...」をクリック

### デバッグ方法
1. **ブラウザの開発者ツール**を開く（F12）
2. **Console**タブでエラーメッセージを確認
3. **Network**タブでAPIリクエストの状況を確認

### サポート
問題が解決しない場合は、以下を確認してください：
- ブラウザのバージョンが最新であること
- JavaScriptが有効になっていること
- インターネット接続が安定していること

---

## 更新履歴

### v2.1.0 (2025年)
- スプレッドシート入力機能の強化（バネ定数、F値カスタム入力対応）
- 節点番号の表示スタイル改善（丸囲い数字）
- バグ修正とパフォーマンス向上

### v2.0.0 (2024年)
- AIによるモデル生成機能を追加
- 音声入力機能を追加
- 3Dビューア機能を追加
- 断面情報の完全保持機能を実装
- 選択的部材更新機能を実装

### v1.0.0 (2023年)
- 基本的な2D構造解析機能
- 断面選択機能
- 計算実行機能
- データ保存・読込機能

---

## 技術仕様

### 対応ブラウザ
- Chrome 90以上（推奨）
- Firefox 88以上
- Safari 14以上
- Edge 90以上

### 必要な環境
- JavaScript有効
- インターネット接続（AI機能使用時）
- マイクアクセス（音声入力使用時）

### ファイル構成
```
プロジェクトルート/
├── index.html              # メインアプリケーション
├── frame_analyzer.js       # メインのJavaScriptファイル
├── steel_selector.js       # 断面選択機能
├── viewer_3d.js           # 3Dビューア機能
├── style.css              # スタイルシート
├── steel_data.js          # 鋼材データベース
└── api/
    └── generate-model.js  # AI生成API
```

---

この操作ガイドは、Statica 2Dの全機能を網羅的に説明しています。各機能の詳細な使用方法については、アプリケーション内のヘルプアイコン（?）をクリックしてください。
